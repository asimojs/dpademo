import{options as M,createContext as W,h as Y,render as ee}from"preact";import{interfaceId as I,asm as y}from"@asimojs/asimo";import{component as b,componentId as N,useTraxState as te}from"@traxjs/trax-preact";import{useContext as ne}from"preact/hooks";import{trax as q}from"@traxjs/trax";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const o of d)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(d){const o={};return d.integrity&&(o.integrity=d.integrity),d.referrerPolicy&&(o.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?o.credentials="include":d.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(d){if(d.ep)return;d.ep=!0;const o=n(d);fetch(d.href,o)}})();const re="modulepreload",se=function(e){return"/"+e},V={},C=function(t,n,l){if(!n||n.length===0)return t();const d=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=se(o),o in V)return;V[o]=!0;const i=o.endsWith(".css"),a=i?'[rel="stylesheet"]':"";if(!!l)for(let c=d.length-1;c>=0;c--){const p=d[c];if(p.href===o&&(!i||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const s=document.createElement("link");if(s.rel=i?"stylesheet":re,i||(s.as="script",s.crossOrigin=""),s.href=o,document.head.appendChild(s),i)return new Promise((c,p)=>{s.addEventListener("load",c),s.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())},j=I("asimo.doc.stores.NavService"),$=I("asimo.doc.stores.SearchService");var ae=0;function u(e,t,n,l,d,o){var i,a,r={};for(a in t)a=="ref"?i=t[a]:r[a]=t[a];var s={type:e,props:r,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--ae,__source:d,__self:o};if(typeof e=="function"&&(i=e.defaultProps))for(a in i)r[a]===void 0&&(r[a]=i[a]);return M.vnode&&M.vnode(s),s}const oe=b("SearchPanel",e=>u("div",{"data-id":N(),className:"search-panel  py-64",children:u("div",{className:"input-container flex justify-center",children:u(z,{className:"h-11 w-1/2 py-2.5"})})})),z=b("SearchPanel",e=>{let{className:t}=e;return t=t||"",u("div",{className:`${t} flex px-3 bg-neutral-200 rounded-full text-neutral-600
    cursor-pointer
    border border-neutral-200 hover:border-neutral-400`,onClick:n,children:[u("div",{className:"mx-1",children:u(ie,{})}),u("div",{children:["Search: ",u("span",{className:"font-medium text-sky-700",children:" Homer Simpson "})]})]});async function n(){const l=await y.get($);l==null||l.search({searchInput:"Homer Simpson"})}}),ie=b("SearchIcon",()=>{let e=32;return u("svg",{width:e,height:e,viewBox:"0 0 24 24",version:"1.1","aria-hidden":"false",children:[u("desc",{lang:"en",children:"Magnifying glass"}),u("path",{className:"fill-current  stroke-0",d:"M13.07336,12.29053,10.14679,9.364a3.9711,3.9711,0,1,0-.78284.78284l2.92658,2.92657Zm-6.064-2.4516A2.82914,2.82914,0,1,1,9.8385,7.00934,2.83286,2.83286,0,0,1,7.00934,9.83893Z"})]})}),le=b("NavBar",e=>{const{nav:t}=e;let n=!1;const l=t.data.mainView;return n=l.name==="search"&&l.panel==="results",u("div",{"data-id":N(),className:"navbar flex justify-center",children:u("div",{className:"input-container flex flex-grow p-3  max-w-screen-xl",children:[u("div",{className:"w-40 ml-2 text-lg cursor-pointer",onClick:t.home,title:"Dynamic Page Application Demo",children:[u("span",{className:"font-semibold",children:"dpa"})," demo"]}),u("div",{className:"flex-grow",children:n?u(z,{className:"h-8 w-1/2 py-1"}):""}),u("div",{className:"text-neutral-600 mr-2",children:u(ce,{})})]})})}),ce=b("GithubLogo",()=>u("a",{href:"https://github.com/asimojs/dpademo",target:"_blank","aria-valuetext":"Link to project's Github page",children:u("svg",{width:"28",height:"28",viewBox:"0 0 96 98",xmlns:"http://www.w3.org/2000/svg",children:u("path",{className:"fill-current","fill-rule":"evenodd","clip-rule":"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})})),H="__cC0",Z="__c";function K(){return ne({[Z]:H})}let T=0;function ue(){T++,T>1&&console.error("[utils.createGlobalContext] Global Context cannot be re-render and must be used at the application root");const e={mainCtxt:null,subCtxts:{}},t=W(e);return e.mainCtxt=t,(!t||t[Z]!==H)&&console.error("[utils.createGlobalContext] New preact version detected - please update the utils library!"),n=>u(t.Provider,{value:e,children:n.children})}function de(e,t){let n=K();return n||(n={mainCtxt:null,subCtxts:{}},console.error("[UTILS] Global Context not found -> createGlobalContext() is required to use createContext()")),n.subCtxts[e.ns]=t,{Provider:l=>{const{value:d,children:o}=l;d!==void 0&&(n.subCtxts[e.ns]=l.value);const i=n.mainCtxt;return u(i.Provider,{value:n,children:o})}}}function fe(e,t=null){const n=K();return n?n.subCtxts[e.ns]||t:null}const J=I("asimo.dpademo.views.Lml2JSX"),pe=b("SearchResultsPanel",e=>{const{searchService:t,nav:n}=e,l=t.data.lastResult,d=te({ctxt:null});if(l===null||l.type==="Error")return u("div",{children:"[Under construction]"});const o=l.results,i=l.lml2jsx;d.ctxt||(d.ctxt=de(J,i));const a=d.ctxt;return u(a.Provider,{value:i,children:u("div",{"data-id":N(),className:"results-container flex justify-center text-sm",children:u("div",{className:"w-full max-w-screen-xl relative",children:[u("div",{className:"header bg-neutral-100 p-5 text-sm",children:u("div",{children:[" About ",u("b",{className:"font-bold",children:o.totalMatchCount})," results (",o.processingTime," seconds) "]})}),u("div",{className:"body flex pt-3 px-5",children:[u("div",{className:"main flex-grow me-5",children:u(me,{content:o.main})}),u("div",{className:"sidebar w-4/12",children:o.sidebar?u("div",{className:"text-neutral-700 border-l border-l-neutral-200 ps-5 pb-9",children:i(o.sidebar)}):""})]}),u("div",{className:"popover absolute w-5/12 top-0 right-0",children:o.popover&&i(o.popover)})]})})})}),me=b("ResultsPanel",e=>{const{content:t}=e,n=fe(J,()=>"[...]");return u("div",{className:"results-panel",lang:"en",children:u("div",{style:{width:657},className:"text-neutral-700",children:t?n(t):""})})}),he=b("MainLayout",e=>{const{nav:t}=e,n=t.data.mainView;let l="[...]";return n.name==="search"?n.panel==="results"?l=u(pe,{searchService:n.$store,nav:t}):n.panel==="search"&&(l=u(oe,{nav:t})):n.name==="doc"&&(l="[ Under construction ]"),u("div",{"data-id":N(),className:"main-layout",style:{minWidth:"1024px"},children:[u(le,{nav:t}),l]})});async function ge(e){if(e.searchInput==="Homer Simpson"){const t=await C(()=>import("./homer-0d584979.js"),[]);return ve(t.default)}return{type:"Error",message:"Invalid query: "+e.searchInput}}function ve(e){return JSON.parse(JSON.stringify(e))}const X=I("asimo.doc.api.SearchAPI");y.registerService(X,()=>ge);function ye(){return q.createStore("NavService",e=>{let t=null;const n=e.init({mainView:{name:"loading"}},{init:function*(l,d){d.maxComputeCount=1,t=yield y.get($),l.mainView.name==="loading"&&(l.mainView={name:"search",panel:"search",$store:t})}});return{data:n,home(){n.mainView={name:"search",panel:"search",$store:t}}}})}y.registerService(j,ye);function S(e){if(Array.isArray(e)){if(e.length===0)return"fragment";const t=e[0];if(typeof t=="string"&&t.length>1){const n=t[0];if(n===B)return"element";if(n===Q)return"component";if(n===O||n===xe)return"invalid"}return"fragment"}else if(typeof e=="string")return"text";return"invalid"}const B="#",Q="*",O="@",xe="!",be="!",we=".",Se=/^(\#|\*|\!|\@)(\w+\:)?([\w\-]+)(\+[\w\-]+)?(\.[\.\w\-]+)*(\!.+)?$/;function U(e,t){if(e==null)return"";const n=S(e);if(n==="text")return a(e);if(n==="invalid")return r(`Invalid LML node: ${JSON.stringify(e)}`);const l=n==="fragment",d=e,o=d.length;if(o===0)return"";if(!l){const s=d[0].match(Se);if(s){const c=s[1],p=s[2],f=s[3],m=s[4],x=s[5],v=s[6],A=p?p.slice(0,-1):"",_=m?m.slice(1):"";let w;if(x){const g=x.split(we);w=[];for(const E of g)E!=""&&w.push(E)}let R=1,h;const P=d[R];if(P&&typeof P=="object"&&!Array.isArray(P)){h=P,R++,(_||w||v)&&(_&&(h.type=_),w&&(h.class&&typeof h.class=="string"?h.class=w.join(" ")+" "+h.class:h.class=w.join(" ")),v&&(h.keyValue=h.key=v.slice(1)),d[0]=`${c}${p||""}${f}`);const g=h.key;g&&g!==h.keyValue&&(h.keyValue=h.key)}else{if(v){const g=v.slice(1);h={key:g,keyValue:g}}(w||_)&&(h=h||{},_&&(h.type=_),w&&(h.class=w.join(" ")))}let k;if(o>R){k=[];for(let g=R;g<o;g++)k.push(U(d[g],t))}if(c===B||c===Q||c===O){let g=c===B?"element":"component";c===O&&(g="decorator");const E={type:g,tagName:f,ns:A};return t.format(E,h,k)}else r(`Unsupported node prefix: ${c}`);return""}}const i=[];for(const s of d)if(typeof s=="string"||Array.isArray(s)){const c=U(s,t);if(c)if(Array.isArray(c))for(let p of c)i.push(p);else i.push(c)}else r(`Invalid LML node: ${JSON.stringify(s)}`);return i.length>0?i:"";function a(s){return t.format({type:"text",value:s})}function r(s){return t.error?(s.length>100&&(s=s.slice(0,100)+"..."),t.error(s)):console.error("[LML Scan Error] "+s),""}}const Ne={allowedElements:new Set(["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","img"]),forbiddenElementAttributes:new Set(["style","srcset"]),forbidEventHandlers:!0,urlAttributes:new Set(["href","src","cite","action","profile","longdesc","usemap","formaction","icon","poster","background","codebase","data","classid","manifest"]),allowedUrlPrefixes:["/","./","http://","https://","mailto://","tel://","data:image/"]};function _e(e,t,n,l,d){l=l||(a=>console.error("[lm2JSX Error] "+a));const o=d||Ne;let i=null;if(o.allowedUrlPrefixes.length){const a=`^(${o.allowedUrlPrefixes.join("|")})`;i=new RegExp(a,"i")}return U(e,{format:(a,r,s)=>{const c=a.type;if(c==="text")return a.value;if(c==="element"||c==="component"){if(c==="element"){if(!o.allowedElements.has(a.tagName))return l(`Unauthorized element: ${a.tagName}`),"";if(r){for(const f of Object.getOwnPropertyNames(r))if(o.forbiddenElementAttributes.has(f))l(`Unauthorized element attribute: ${f}`),delete r[f];else if(o.forbidEventHandlers&&f.match(/^on/i))l(`Unauthorized event handler: ${f}`),delete r[f];else if(i&&o.urlAttributes.has(f)){const m=r[f];(typeof m!="string"||!m.match(i))&&(l(`Unauthorized URL: ${f}="${m}"`),delete r[f])}}}r&&r.class&&!r.className&&(r.className=r.class);let p=a.tagName;if(c==="component"){const f=n&&n(p,a.ns||"")||null;if(!f)return l("Invalid component: "+(a.ns?a.ns+":":"")+p),"";p=f}return s?t(p,r||null,...s):t(p,r||null)}return l("Unsupported node type: "+c),""},error:l})}function D(e,t){let n=S(e)==="fragment"?e:[e];const l=new Set;for(const i of t)i.node&&l.add(i.node);const d=new Map,o=l.size;if(o>0){let i=0;L(e,(a,r,s,c)=>(l.has(a)&&(i++,d.set(a,{node:r,parent:s,parentRef:c})),i<o),n,0)}for(const i of t){const a=i.action;let r=n,s=null,c="",p="";if(i.node){let f=d.get(i.node);if(f){if(s=f.parent,c=f.parentRef,r=f.node,p=i.path||"",p===""){const m=S(r);m!=="invalid"&&m!=="text"&&(a==="append"||a==="prepend")&&(p="children")}}else continue}if(p==="children"){if(r.length>1){let f=1;if(typeof r[f]!="string"&&!Array.isArray(r[f])&&f++,a==="delete")r.splice(f,r.length-f);else{const m=i.content,x=S(m);if(x!=="invalid"){const v=x==="fragment";a==="insertBefore"||a==="prepend"?v?r.splice.apply(r,[f,0,...m]):r.splice(f,0,m):a==="insertAfter"||a==="append"?v?r.push.apply(r,m):r.push(m):a==="replace"&&(v?r.splice.apply(r,[f,r.length-f,...m]):r.splice(f,r.length-f,m))}}}continue}else if(p){const f=p.split("/");if(Array.isArray(r)&&r.length>1)r=r[1];else continue;for(const m of f)s=r,c=m,r=s[c]}if(r)if(a==="delete")Array.isArray(s)?typeof c=="number"&&s.splice(c,1):s?s[c]=[]:n=[];else{const f=i.content,m=S(f);if(m!=="invalid"){const x=m==="fragment";if(a==="insertBefore"||a==="insertAfter"||a==="replace")if(Array.isArray(s)){if(typeof c=="number"){let v=c,A=0;a==="insertAfter"?v++:a==="replace"&&A++,x?s.splice.apply(s,[v,A,...f]):s.splice(v,A,f)}}else s?a==="insertBefore"?x?s[c]=[...f,r]:s[c]=[f,r]:a==="insertAfter"?x?s[c]=[r,...f]:s[c]=[r,f]:a==="replace"&&(s[c]=f):a==="replace"&&(n=x?f:[f]);else(a==="prepend"||a==="append")&&S(r)==="fragment"&&(a==="append"?x?r.push.apply(r,f):r.push(f):a==="prepend"&&(x?r.splice.apply(r,[0,0,...f]):r.splice(0,0,f)))}}}return n.length===1?n[0]:n}function L(e,t,n,l){if(!e)return!0;const d=S(e);if(Array.isArray(e)&&e.length){if(d==="component"||d==="element"){let o="";const i=e[0].indexOf(be);if(i>-1)o=e[0].slice(i+1);else{const a=e[1];a&&typeof a=="object"&&!Array.isArray(a)&&(o=a.key)}if(o&&t(o,e,n,l)===!1)return!1;for(let a=1;e.length>a;a++)if(!L(e[a],t,e,a))return!1}else for(let o=0;e.length>o;o++)if(!L(e[o],t,e,o))return!1}else if(typeof e=="object"){for(const o of Object.getOwnPropertyNames(e))if(!L(e[o],t,e,o))return!1}return!0}async function Ae(e){if(e.searchInput==="Homer Simpson"){const t=e.src.lastContentKey;if(t==="2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAheEAA")return(await C(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAheEAA-4a719544.js"),[])).default;if(t==="2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAhAAAB")return(await C(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAhAAAB-cb394a54.js"),[])).default;if(e.src.componentType==="ImgList")return(await C(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Q_R16BAgkEAA1-fa4dd09d.js"),[])).default}return{type:"Error",message:"Invalid query: "+e.searchInput}}const F=I("asimo.doc.api.SearchMoreAPI");y.registerService(F,()=>Ae);function Ce(){return q.createStore("SearchService",e=>{const t=e.init({query:{searchInput:""},lastResult:null}),n={};let l={};const d={data:t,async search(i,a=!0){const r=i||t.query,c=await(await y.get(X))(r);return c.type==="SearchResponse"?(await d.loadSearchResponse(c,r,a),!0):!1},async loadSearchResponse(i,a,r=!0){l={};try{await G(i.bundles,l),r&&await o()}catch(s){console.log("Module load error:",s)}t.lastResult={type:"SearchResults",query:{searchInput:a.searchInput},results:i,lml2jsx:s=>_e(s,Y,(c,p)=>{if(p){if(l&&l[p])return l[p][c]||null}else return n[c]||null;return null})}},async getMoreResults(i,a=!0){if(!t.lastResult||t.lastResult.type!=="SearchResults")return!1;const s=await(await y.get(F))(i);if(s.type==="SearchResponse"){try{await G(s.bundles,l),a&&await o()}catch(c){console.log("Module load error:",c)}if(s.mainUpdates){const c=t.lastResult.results;s.main?c.main=s.main:s.mainUpdates&&(c.main=D(c.main,s.mainUpdates))}if(s.popoverUpdates){const c=t.lastResult.results;c.popover||(c.popover=[]),c.popover=D(c.popover,s.popoverUpdates)}}return!0},registerBaseComponent(i,a){n[i]=a},closePopover(){const i=t.lastResult;i&&i.type==="SearchResults"&&i.results.popover&&(i.results.popover="")}};return d;async function o(){const i=await y.get(j);i.data.mainView={name:"search",panel:"results",$store:d}}})}const Ie=/^(\/)|(.\/)/i;async function G(e,t){if(e){const n=[],l=[];for(const r of Object.getOwnPropertyNames(e)){const s=e[r].ns;e[r].src.match(Ie)&&(n.push({name:r,ns:s,src:e[r].src}),l.push(s))}const d=await y.get.apply(y,l);let o=Array.isArray(d)?d:[d];const i=[],a=[];for(let r=0;o.length>r;r++)o[r]?n[r].module=o[r]:(a.push(r),i.push(C(()=>import(n[r].src),[])));if(a.length){const r=await Promise.all(i);for(let s=0;r.length>s;s++)n[a[s]].module=r[s].default}if(t)for(let r of n)t[r.name]=r.module}}y.registerService($,Ce);const Re=b("Button",e=>{let{href:t,align:n,className:l,children:d}=e;n=n||"center",l=l||"";let o="justify-center";return n==="start"&&(o="justify-start pl-3"),u("div",{"data-id":N(),className:`btn flex ${l} h-12`,children:u("a",{href:t,className:`flex-grow flex bg-neutral-200 mt-2 rounded-full ${o} hover:bg-neutral-400 hover:text-white`,children:u("span",{"data-id":N(),className:"h-full pt-2.5 text-base overflow-hidden",children:d})})})}),Pe=b("Icon",e=>{let{type:t,size:n,className:l}=e;if(t=t||"magnifier",t==="magnifier"){n=n||22;const o=`inline-block relative ${l||"mx-2"}`;return u("svg",{width:n,height:n,viewBox:"0 0 18 18",version:"1.1","aria-hidden":"false",className:o,children:[u("desc",{lang:"en",children:"Magnifying glass"}),u("path",{className:"fill-current  stroke-0",d:"M13.07336,12.29053,10.14679,9.364a3.9711,3.9711,0,1,0-.78284.78284l2.92658,2.92657Zm-6.064-2.4516A2.82914,2.82914,0,1,1,9.8385,7.00934,2.83286,2.83286,0,0,1,7.00934,9.83893Z"})]})}n=n||18;const d=`inline-block relative ${l||"-top-0.5 mx-2"}`;return u("svg",{width:n,height:n,focusable:"false",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 22",className:d,children:u("path",{className:"fill-current",d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})})}),Ee=b("Columns",e=>{let{className:t,children:n}=e;return t=t||"mt-4",u("div",{"data-id":N(),className:`columns ${t} columns-2`,children:u("div",{children:n})})});async function Le(){const e=await y.get(j),t=await y.get($);t.registerBaseComponent("btn",Re),t.registerBaseComponent("icon",Pe),t.registerBaseComponent("cols",Ee);const n=globalThis["init-state"];n&&n.dataType==="SearchResponse"&&await t.loadSearchResponse(n.data.response,n.data.query);const l=ue();ee(u(l,{children:u("div",{className:"mainapp",children:u(he,{nav:e})})}),document.getElementById("main"))}Le();
