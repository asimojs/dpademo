import{options as D,createContext as Q,h as W,render as Y}from"preact";import{interfaceId as E,asm as x}from"@asimojs/asimo";import{component as A,componentId as O}from"@traxjs/trax-preact";import{useContext as ee}from"preact/hooks";import{trax as K}from"@traxjs/trax";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const te="modulepreload",ne=function(e){return"/"+e},V={},L=function(t,r,s){if(!r||r.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(r.map(a=>{if(a=ne(a),a in V)return;V[a]=!0;const c=a.endsWith(".css"),i=c?'[rel="stylesheet"]':"";if(!!s)for(let d=o.length-1;d>=0;d--){const p=o[d];if(p.href===a&&(!c||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${i}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":te,c||(l.as="script",l.crossOrigin=""),l.href=a,document.head.appendChild(l),c)return new Promise((d,p)=>{l.addEventListener("load",d),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())},B=E("asimo.doc.stores.NavService"),T=E("asimo.doc.stores.SearchService");var re=0;function u(e,t,r,s,o,a){var c,i,n={};for(i in t)i=="ref"?c=t[i]:n[i]=t[i];var l={type:e,props:n,key:r,ref:c,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--re,__source:o,__self:a};if(typeof e=="function"&&(c=e.defaultProps))for(i in c)n[i]===void 0&&(n[i]=c[i]);return D.vnode&&D.vnode(l),l}const se=A("SearchPanel",e=>u("div",{"data-id":O(),className:"search-panel  py-64",children:u("div",{className:"input-container flex justify-center",children:u(q,{className:"h-11 w-1/2 py-2.5"})})})),q=A("SearchPanel",e=>{let{className:t}=e;return t=t||"",u("div",{className:`${t} flex px-3 bg-neutral-200 rounded-full text-neutral-600
    cursor-pointer
    border border-neutral-200 hover:border-neutral-400`,onClick:r,children:[u("div",{className:"mx-1",children:u(ie,{})}),u("div",{children:["Search: ",u("span",{className:"font-medium text-sky-700",children:" Homer Simpson "})]})]});async function r(){const s=await x.get(T);s==null||s.search({searchInput:"Homer Simpson"})}}),ie=A("SearchIcon",()=>{let e=32;return u("svg",{width:e,height:e,viewBox:"0 0 24 24",version:"1.1","aria-hidden":"false",children:[u("desc",{lang:"en",children:"Magnifying glass"}),u("path",{className:"fill-current  stroke-0",d:"M13.07336,12.29053,10.14679,9.364a3.9711,3.9711,0,1,0-.78284.78284l2.92658,2.92657Zm-6.064-2.4516A2.82914,2.82914,0,1,1,9.8385,7.00934,2.83286,2.83286,0,0,1,7.00934,9.83893Z"})]})}),oe=A("NavBar",e=>{const{nav:t}=e;let r=!1;const s=t.data.mainView;return r=s.name==="search"&&s.panel==="results",u("div",{"data-id":O(),className:"navbar flex justify-center",children:u("div",{className:"input-container flex flex-grow p-3  max-w-screen-xl",children:[u("div",{className:"w-40 ml-2 text-lg cursor-pointer",onClick:t.home,title:"Dynamic Page Application Demo",children:[u("span",{className:"font-semibold",children:"dpa"})," demo"]}),u("div",{className:"flex-grow",children:r?u(q,{className:"h-8 w-1/2 py-1"}):""}),u("div",{className:"text-neutral-600 mr-2",children:u(ae,{})})]})})}),ae=A("GithubLogo",()=>u("a",{href:"https://github.com/asimojs/dpademo",target:"_blank","aria-valuetext":"Link to project's Github page",children:u("svg",{width:"28",height:"28",viewBox:"0 0 96 98",xmlns:"http://www.w3.org/2000/svg",children:u("path",{className:"fill-current","fill-rule":"evenodd","clip-rule":"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})})),F="__cC0",z="__c";function le(){return ee({[z]:F})}let $=0;function ce(){$++,$>1&&console.error("[utils.createGlobalContext] Global Context cannot be re-render and must be used at the application root");const e={mainCtxt:null,subCtxts:{}},t=Q(e);return e.mainCtxt=t,(!t||t[z]!==F)&&console.error("[utils.createGlobalContext] New preact version detected - please update the utils library!"),r=>u(t.Provider,{value:e,children:r.children})}function ue(e,t){let r=le();return r||(r={mainCtxt:null,subCtxts:{}},console.error("[UTILS] Global Context not found -> createGlobalContext() is required to use createContext()")),r.subCtxts[e.ns]=t,{Provider:s=>{const{value:o,children:a}=s;o!==void 0&&(r.subCtxts[e.ns]=s.value);const c=r.mainCtxt;return u(c.Provider,{value:r,children:a})}}}const fe=E("asimo.dpademo.views.Lml2JSX"),de=A("SearchResultsPanel",e=>{const{searchService:t,nav:r}=e,s=t.data.lastResult;if(s===null||s.type==="Error")return u("div",{children:"[Under construction]"});const o=s.results,a=ue(fe,s.lml2jsx);return u(a.Provider,{value:s.lml2jsx,children:u("div",{"data-id":O(),className:"results-container flex justify-center text-sm",children:u("div",{className:"w-full max-w-screen-xl",children:[u("div",{className:"header bg-neutral-100 p-5 text-sm",children:u("div",{children:[" About ",u("b",{className:"font-bold",children:o.totalMatchCount})," results (",o.processingTime," seconds) "]})}),u("div",{className:"body flex pt-3 px-5",children:[u("div",{className:"main flex-grow me-5",children:pe(t)}),u("div",{className:"sidebar w-4/12",children:o.sidebar?u("div",{className:"text-neutral-700 border-l border-l-neutral-200 ps-5 pb-9",children:s.lml2jsx(o.sidebar)}):""})]})]})})})});function pe(e,t){const s=e.data.lastResult;return s===null?"":u("div",{className:"searchResults",lang:"en",children:[s.type==="Error"?u("div",{className:"Error",children:["Error: ",s.message]}):"",s.type==="SearchResults"?me(e,s):""]})}function me(e,t){return t.results,u("div",{className:"searchResults",lang:"en",children:u("div",{style:{width:657},className:"text-neutral-700",children:t.lml2jsx(t.results.main)})})}const he=A("MainLayout",e=>{const{nav:t}=e,r=t.data.mainView;let s="[...]";return r.name==="search"?r.panel==="results"?s=u(de,{searchService:r.$store,nav:t}):r.panel==="search"&&(s=u(se,{nav:t})):r.name==="doc"&&(s="[ Under construction ]"),u("div",{"data-id":O(),className:"main-layout",style:{minWidth:"1024px"},children:[u(oe,{nav:t}),s]})});async function ye(e){if(e.searchInput==="Homer Simpson"){const t=await L(()=>import("./homer-70583603.js"),[]);return ve(t.default)}return{type:"Error",message:"Invalid query: "+e.searchInput}}function ve(e){return JSON.parse(JSON.stringify(e))}const H=E("asimo.doc.api.SearchAPI");x.registerService(H,()=>ye);function ge(){return K.createStore("NavService",e=>{let t=null;const r=e.init({mainView:{name:"loading"}},{init:function*(s,o){o.maxComputeCount=1,t=yield x.get(T),s.mainView.name==="loading"&&(s.mainView={name:"search",panel:"search",$store:t})}});return{data:r,home(){r.mainView={name:"search",panel:"search",$store:t}}}})}x.registerService(B,ge);function N(e){if(Array.isArray(e)){if(e.length===0)return"fragment";const t=e[0];if(typeof t=="string"&&t.length>1){const r=t[0];if(r===k)return"element";if(r===J)return"component";if(r===j||r===xe)return"invalid"}return"fragment"}else if(typeof e=="string")return"text";return"invalid"}const k="#",J="*",j="@",xe="!",we="!",Se=".",be=/^(\#|\*|\!|\@)(\w+\:)?([\w\-]+)(\+[\w\-]+)?(\.[\.\w\-]+)*(\!.+)?$/;function M(e,t){if(e==null)return"";const r=N(e);if(r==="text")return i(e);if(r==="invalid")return n(`Invalid LML node: ${JSON.stringify(e)}`);const s=r==="fragment",o=e,a=o.length;if(a===0)return"";if(!s){const d=o[0].match(be);if(d){const p=d[1],m=d[2],f=d[3],_=d[4],h=d[5],y=d[6],S=m?m.slice(0,-1):"",g=_?_.slice(1):"";let w;if(h){const b=h.split(Se);w=[];for(const C of b)C!=""&&w.push(C)}let R=1,v;const I=o[R];I&&typeof I=="object"&&!Array.isArray(I)&&(v=I,R++,g&&(v.type=g),w&&(v.class&&typeof v.class=="string"?v.class=w.join(" ")+" "+v.class:v.class=w.join(" "))),!v&&(w||g)&&(v={},g&&(v.type=g),w&&(v.class=w.join(" "))),y&&(v||(v={}),v.key=y.slice(1));let U;if(a>R){U=[];for(let b=R;b<a;b++)U.push(M(o[b],t))}if(p===k||p===J||p===j){let b=p===k?"element":"component";p===j&&(b="decorator");const C={type:b,tagName:f,ns:S};return t.format(C,v,U)}else n(`Unsupported node prefix: ${p}`);return""}}const c=[];for(const l of o)if(typeof l=="string"||Array.isArray(l)){const d=M(l,t);if(d)if(Array.isArray(d))for(let p of d)c.push(p);else c.push(d)}else n(`Invalid LML node: ${JSON.stringify(l)}`);return c.length>0?c:"";function i(l){return t.format({type:"text",value:l})}function n(l){return t.error?(l.length>100&&(l=l.slice(0,100)+"..."),t.error(l)):console.error("[LML Scan Error] "+l),""}}const Ae={allowedElements:new Set(["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","img"]),forbiddenElementAttributes:new Set(["style","srcset"]),forbidEventHandlers:!0,urlAttributes:new Set(["href","src","cite","action","profile","longdesc","usemap","formaction","icon","poster","background","codebase","data","classid","manifest"]),allowedUrlPrefixes:["/","./","http://","https://","mailto://","tel://","data:image/"]};function _e(e,t,r,s,o){s=s||(i=>console.error("[lm2JSX Error] "+i));const a=o||Ae;let c=null;if(a.allowedUrlPrefixes.length){const i=`^(${a.allowedUrlPrefixes.join("|")})`;c=new RegExp(i,"i")}return M(e,{format:(i,n,l)=>{const d=i.type;if(d==="text")return i.value;if(d==="element"||d==="component"){if(d==="element"){if(!a.allowedElements.has(i.tagName))return s(`Unauthorized element: ${i.tagName}`),"";if(n){for(const m of Object.getOwnPropertyNames(n))if(a.forbiddenElementAttributes.has(m))s(`Unauthorized element attribute: ${m}`),delete n[m];else if(a.forbidEventHandlers&&m.match(/^on/i))s(`Unauthorized event handler: ${m}`),delete n[m];else if(c&&a.urlAttributes.has(m)){const f=n[m];(typeof f!="string"||!f.match(c))&&(s(`Unauthorized URL: ${m}="${f}"`),delete n[m])}}}n&&n.class&&(n.className=n.class),n&&n.key&&(n.keyValue=n.key);let p=i.tagName;if(d==="component"){const m=r&&r(p,i.ns||"")||null;if(!m)return s("Invalid component: "+(i.ns?i.ns+":":"")+p),"";p=m}return l?t(p,n||null,...l):t(p,n||null)}return s("Unsupported node type: "+d),""},error:s})}function Ne(e,t){const r=new Set;for(const i of t)r.add(i.node);const s=new Map,o=r.size;let a=0;const c=[e];P(e,(i,n,l,d)=>(r.has(i)&&(a++,s.set(i,{node:n,parent:l,parentRef:d})),a<o),c,0);for(const i of t){const n=i.action,l=i.node;let d=s.get(l);if(!d)continue;let p=d.parent,m=d.parentRef,f=d.node;const _=i.path;if(_==="children"){if(f.length>1){let h=1;if(typeof f[h]!="string"&&!Array.isArray(f[h])&&h++,n==="delete")f.splice(h,f.length-h);else{const y=i.content,S=N(y);if(S!=="invalid"){const g=S==="fragment";n==="insertBefore"||n==="prepend"?g?f.splice.apply(f,[h,0,...y]):f.splice(h,0,y):n==="insertAfter"||n==="append"?g?f.push.apply(f,y):f.push(y):n==="replace"&&(g?f.splice.apply(f,[h,f.length-h,...y]):f.splice(h,f.length-h,y))}}}continue}else if(_){const h=_.split("/");if(Array.isArray(f)&&f.length>1)f=f[1];else continue;for(const y of h)p=f,m=y,f=p[m]}if(d)if(n==="delete")Array.isArray(p)?typeof m=="number"&&p.splice(m,1):p&&(p[m]=[]);else{const h=i.content,y=N(h);if(y!=="invalid"){const S=y==="fragment";if(n==="insertBefore"||n==="insertAfter"||n==="replace")if(Array.isArray(p)){if(typeof m=="number"){let g=m,w=0;n==="insertAfter"?g++:n==="replace"&&w++,S?p.splice.apply(p,[g,w,...h]):p.splice(g,w,h)}}else p&&(n==="insertBefore"?S?p[m]=[...h,f]:p[m]=[h,f]:n==="insertAfter"?S?p[m]=[f,...h]:p[m]=[f,h]:n==="replace"&&(p[m]=h));else(n==="prepend"||n==="append")&&N(f)==="fragment"&&(n==="append"?S?f.push.apply(f,h):f.push(h):n==="prepend"&&(S?f.splice.apply(f,[0,0,...h]):f.splice(0,0,h)))}}}return c.length===1?c[0]:c}function P(e,t,r,s){if(!e)return!0;const o=N(e);if(Array.isArray(e)&&e.length){if(o==="component"||o==="element"){let c="";const n=e[0].indexOf(we);if(n>-1&&(c=e[0].slice(n+1)),c&&t(c,e,r,s)===!1)return!1;for(let l=1;e.length>l;l++)if(!P(e[l],t,e,l))return!1}else for(let c=0;e.length>c;c++)if(!P(e[c],t,e,c))return!1}else if(typeof e=="object"){for(const a of Object.getOwnPropertyNames(e))if(!P(e[a],t,e,a))return!1}return!0}async function Ee(e){if(e.searchInput==="Homer Simpson"){const t=e.src.lastContentKey;if(t==="2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAheEAA"){const r=await L(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAheEAA-348637c6.js"),[]);return await G(300),r.default}if(t==="2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAhAAAB"){const r=await L(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAhAAAB-d8774c9b.js"),[]);return await G(300),r.default}}return{type:"Error",message:"Invalid query: "+e.searchInput}}function G(e){return new Promise(t=>{setTimeout(t,e)})}const Z=E("asimo.doc.api.SearchMoreAPI");x.registerService(Z,()=>Ee);function Re(){return K.createStore("SearchService",e=>{const t=e.init({query:{searchInput:""},lastResult:null}),r={data:t,async search(o,a=!0){const c=o||t.query,n=await(await x.get(H))(c);return n.type==="SearchResponse"?(await r.loadSearchResponse(n,c,a),!0):!1},async loadSearchResponse(o,a,c=!0){const i={};try{await X(o.bundles,i),c&&await s()}catch(n){console.log("Module load error:",n)}t.lastResult={type:"SearchResults",query:{searchInput:a.searchInput},results:o,lml2jsx:n=>_e(n,W,(l,d)=>i&&i[d]&&i[d][l]||null)}},async getMoreResults(o,a=!0){if(!t.lastResult||t.lastResult.type!=="SearchResults")return!1;const i=await(await x.get(Z))(o);if(i.type==="SearchResponse"){const n={};try{await X(i.bundles,n),a&&await s()}catch(l){console.log("Module load error:",l)}if(i.mainUpdates||i.sidebarUpdates){const l=t.lastResult.results;i.main?l.main=i.main:i.mainUpdates&&Ne(l.main,i.mainUpdates)}}return!0}};return r;async function s(){const o=await x.get(B);o.data.mainView={name:"search",panel:"results",$store:r}}})}const Ie=/^(\/)|(.\/)/i;async function X(e,t){if(e){const r=[],s=[];for(const n of Object.getOwnPropertyNames(e)){const l=e[n].ns;e[n].src.match(Ie)&&(r.push({name:n,ns:l,src:e[n].src}),s.push(l))}const o=await x.get.apply(x,s);let a=Array.isArray(o)?o:[o];const c=[],i=[];for(let n=0;a.length>n;n++)a[n]?r[n].module=a[n]:(i.push(n),c.push(L(()=>import(r[n].src),[])));if(i.length){const n=await Promise.all(c);for(let l=0;n.length>l;l++)r[i[l]].module=n[l].default}if(t)for(let n of r)t[n.name]=n.module}}x.registerService(T,Re);async function Ce(){const e=await x.get(B),t=globalThis["init-state"];t&&t.dataType==="SearchResponse"&&await(await x.get(T)).loadSearchResponse(t.data.response,t.data.query);const r=ce();Y(u(r,{children:u("div",{className:"mainapp",children:u(he,{nav:e})})}),document.getElementById("main"))}Ce();
