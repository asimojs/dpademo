import{options as M,createContext as Q,h as F,render as W}from"preact";import{interfaceId as I,asm as w}from"@asimojs/asimo";import{component as x,componentId as A}from"@traxjs/trax-preact";import{useContext as Y}from"preact/hooks";import{trax as G}from"@traxjs/trax";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function r(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(l){if(l.ep)return;l.ep=!0;const s=r(l);fetch(l.href,s)}})();const ee="modulepreload",te=function(t){return"/"+t},T={},L=function(e,r,a){if(!r||r.length===0)return e();const l=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=te(s),s in T)return;T[s]=!0;const u=s.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(!!a)for(let d=l.length-1;d>=0;d--){const m=l[d];if(m.href===s&&(!u||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${c}`))return;const o=document.createElement("link");if(o.rel=u?"stylesheet":ee,u||(o.as="script",o.crossOrigin=""),o.href=s,document.head.appendChild(o),u)return new Promise((d,m)=>{o.addEventListener("load",d),o.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())},k=I("asimo.doc.stores.NavService"),B=I("asimo.doc.stores.SearchService");var re=0;function i(t,e,r,a,l,s){var u,c,n={};for(c in e)c=="ref"?u=e[c]:n[c]=e[c];var o={type:t,props:n,key:r,ref:u,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--re,__source:l,__self:s};if(typeof t=="function"&&(u=t.defaultProps))for(c in u)n[c]===void 0&&(n[c]=u[c]);return M.vnode&&M.vnode(o),o}const ne=x("SearchPanel",t=>i("div",{"data-id":A(),className:"search-panel  py-64",children:i("div",{className:"input-container flex justify-center",children:i(z,{className:"h-11 w-1/2 py-2.5"})})})),z=x("SearchPanel",t=>{let{className:e}=t;return e=e||"",i("div",{className:`${e} flex px-3 bg-neutral-200 rounded-full text-neutral-600
    cursor-pointer
    border border-neutral-200 hover:border-neutral-400`,onClick:r,children:[i("div",{className:"mx-1",children:i(se,{})}),i("div",{children:["Search: ",i("span",{className:"font-medium text-sky-700",children:" Homer Simpson "})]})]});async function r(){const a=await w.get(B);a==null||a.search({searchInput:"Homer Simpson"})}}),se=x("SearchIcon",()=>{let t=32;return i("svg",{width:t,height:t,viewBox:"0 0 24 24",version:"1.1","aria-hidden":"false",children:[i("desc",{lang:"en",children:"Magnifying glass"}),i("path",{className:"fill-current  stroke-0",d:"M13.07336,12.29053,10.14679,9.364a3.9711,3.9711,0,1,0-.78284.78284l2.92658,2.92657Zm-6.064-2.4516A2.82914,2.82914,0,1,1,9.8385,7.00934,2.83286,2.83286,0,0,1,7.00934,9.83893Z"})]})}),ae=x("NavBar",t=>{const{nav:e}=t;let r=!1;const a=e.data.mainView;return r=a.name==="search"&&a.panel==="results",i("div",{"data-id":A(),className:"navbar flex justify-center",children:i("div",{className:"input-container flex flex-grow p-3  max-w-screen-xl",children:[i("div",{className:"w-40 ml-2 text-lg cursor-pointer",onClick:e.home,title:"Dynamic Page Application Demo",children:[i("span",{className:"font-semibold",children:"dpa"})," demo"]}),i("div",{className:"flex-grow",children:r?i(z,{className:"h-8 w-1/2 py-1"}):""}),i("div",{className:"text-neutral-600 mr-2",children:i(ie,{})})]})})}),ie=x("GithubLogo",()=>i("a",{href:"https://github.com/asimojs/dpademo",target:"_blank","aria-valuetext":"Link to project's Github page",children:i("svg",{width:"28",height:"28",viewBox:"0 0 96 98",xmlns:"http://www.w3.org/2000/svg",children:i("path",{className:"fill-current","fill-rule":"evenodd","clip-rule":"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})})),H="__cC0",Z="__c";function oe(){return Y({[Z]:H})}let V=0;function le(){V++,V>1&&console.error("[utils.createGlobalContext] Global Context cannot be re-render and must be used at the application root");const t={mainCtxt:null,subCtxts:{}},e=Q(t);return t.mainCtxt=e,(!e||e[Z]!==H)&&console.error("[utils.createGlobalContext] New preact version detected - please update the utils library!"),r=>i(e.Provider,{value:t,children:r.children})}function ce(t,e){let r=oe();return r||(r={mainCtxt:null,subCtxts:{}},console.error("[UTILS] Global Context not found -> createGlobalContext() is required to use createContext()")),r.subCtxts[t.ns]=e,{Provider:a=>{const{value:l,children:s}=a;l!==void 0&&(r.subCtxts[t.ns]=a.value);const u=r.mainCtxt;return i(u.Provider,{value:r,children:s})}}}const ue=I("asimo.dpademo.views.Lml2JSX"),de=x("SearchResultsPanel",t=>{const{searchService:e,nav:r}=t,a=e.data.lastResult;if(a===null||a.type==="Error")return i("div",{children:"[Under construction]"});const l=a.results,s=ce(ue,a.lml2jsx);return i(s.Provider,{value:a.lml2jsx,children:i("div",{"data-id":A(),className:"results-container flex justify-center text-sm",children:i("div",{className:"w-full max-w-screen-xl",children:[i("div",{className:"header bg-neutral-100 p-5 text-sm",children:i("div",{children:[" About ",i("b",{className:"font-bold",children:l.totalMatchCount})," results (",l.processingTime," seconds) "]})}),i("div",{className:"body flex pt-3 px-5",children:[i("div",{className:"main flex-grow me-5",children:fe(e)}),i("div",{className:"sidebar w-4/12",children:l.sidebar?i("div",{className:"text-neutral-700 border-l border-l-neutral-200 ps-5 pb-9",children:a.lml2jsx(l.sidebar)}):""})]})]})})})});function fe(t,e){const a=t.data.lastResult;return a===null?"":i("div",{className:"searchResults",lang:"en",children:[a.type==="Error"?i("div",{className:"Error",children:["Error: ",a.message]}):"",a.type==="SearchResults"?me(t,a):""]})}function me(t,e){return e.results,i("div",{className:"searchResults",lang:"en",children:i("div",{style:{width:657},className:"text-neutral-700",children:e.lml2jsx(e.results.main)})})}const he=x("MainLayout",t=>{const{nav:e}=t,r=e.data.mainView;let a="[...]";return r.name==="search"?r.panel==="results"?a=i(de,{searchService:r.$store,nav:e}):r.panel==="search"&&(a=i(ne,{nav:e})):r.name==="doc"&&(a="[ Under construction ]"),i("div",{"data-id":A(),className:"main-layout",style:{minWidth:"1024px"},children:[i(ae,{nav:e}),a]})});async function pe(t){if(t.searchInput==="Homer Simpson"){const e=await L(()=>import("./homer-62f291c9.js"),[]);return ge(e.default)}return{type:"Error",message:"Invalid query: "+t.searchInput}}function ge(t){return JSON.parse(JSON.stringify(t))}const K=I("asimo.doc.api.SearchAPI");w.registerService(K,()=>pe);function ve(){return G.createStore("NavService",t=>{let e=null;const r=t.init({mainView:{name:"loading"}},{init:function*(a,l){l.maxComputeCount=1,e=yield w.get(B),a.mainView.name==="loading"&&(a.mainView={name:"search",panel:"search",$store:e})}});return{data:r,home(){r.mainView={name:"search",panel:"search",$store:e}}}})}w.registerService(k,ve);function C(t){if(Array.isArray(t)){if(t.length===0)return"fragment";const e=t[0];if(typeof e=="string"&&e.length>1){const r=e[0];if(r===$)return"element";if(r===J)return"component";if(r===j||r===ye)return"invalid"}return"fragment"}else if(typeof t=="string")return"text";return"invalid"}const $="#",J="*",j="@",ye="!",be="!",we=".",xe=/^(\#|\*|\!|\@)(\w+\:)?([\w\-]+)(\+[\w\-]+)?(\.[\.\w\-]+)*(\!.+)?$/;function U(t,e){if(t==null)return"";const r=C(t);if(r==="text")return c(t);if(r==="invalid")return n(`Invalid LML node: ${JSON.stringify(t)}`);const a=r==="fragment",l=t,s=l.length;if(s===0)return"";if(!a){const o=l[0].match(xe);if(o){const d=o[1],m=o[2],p=o[3],f=o[4],_=o[5],h=o[6],y=m?m.slice(0,-1):"",b=f?f.slice(1):"";let g;if(_){const N=_.split(we);g=[];for(const E of N)E!=""&&g.push(E)}let S=1,v;const R=l[S];R&&typeof R=="object"&&!Array.isArray(R)&&(v=R,S++,b&&(v.type=b),g&&(v.class&&typeof v.class=="string"?v.class=g.join(" ")+" "+v.class:v.class=g.join(" "))),!v&&(g||b)&&(v={},b&&(v.type=b),g&&(v.class=g.join(" "))),h&&(v||(v={}),v.key=h.slice(1));let O;if(s>S){O=[];for(let N=S;N<s;N++)O.push(U(l[N],e))}if(d===$||d===J||d===j){let N=d===$?"element":"component";d===j&&(N="decorator");const E={type:N,tagName:p,ns:y};return e.format(E,v,O)}else n(`Unsupported node prefix: ${d}`);return""}}const u=[];for(const o of l)if(typeof o=="string"||Array.isArray(o)){const d=U(o,e);if(d)if(Array.isArray(d))for(let m of d)u.push(m);else u.push(d)}else n(`Invalid LML node: ${JSON.stringify(o)}`);return u.length>0?u:"";function c(o){return e.format({type:"text",value:o})}function n(o){return e.error?(o.length>100&&(o=o.slice(0,100)+"..."),e.error(o)):console.error("[LML Scan Error] "+o),""}}const Se={allowedElements:new Set(["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","img"]),forbiddenElementAttributes:new Set(["style","srcset"]),forbidEventHandlers:!0,urlAttributes:new Set(["href","src","cite","action","profile","longdesc","usemap","formaction","icon","poster","background","codebase","data","classid","manifest"]),allowedUrlPrefixes:["/","./","http://","https://","mailto://","tel://","data:image/"]};function Ne(t,e,r,a,l){a=a||(c=>console.error("[lm2JSX Error] "+c));const s=l||Se;let u=null;if(s.allowedUrlPrefixes.length){const c=`^(${s.allowedUrlPrefixes.join("|")})`;u=new RegExp(c,"i")}return U(t,{format:(c,n,o)=>{const d=c.type;if(d==="text")return c.value;if(d==="element"||d==="component"){if(d==="element"){if(!s.allowedElements.has(c.tagName))return a(`Unauthorized element: ${c.tagName}`),"";if(n){for(const p of Object.getOwnPropertyNames(n))if(s.forbiddenElementAttributes.has(p))a(`Unauthorized element attribute: ${p}`),delete n[p];else if(s.forbidEventHandlers&&p.match(/^on/i))a(`Unauthorized event handler: ${p}`),delete n[p];else if(u&&s.urlAttributes.has(p)){const f=n[p];(typeof f!="string"||!f.match(u))&&(a(`Unauthorized URL: ${p}="${f}"`),delete n[p])}}}n&&n.class&&(n.className=n.class),n&&n.key&&(n.keyValue=n.key);let m=c.tagName;if(d==="component"){const p=r&&r(m,c.ns||"")||null;if(!p)return a("Invalid component: "+(c.ns?c.ns+":":"")+m),"";m=p}return o?e(m,n||null,...o):e(m,n||null)}return a("Unsupported node type: "+d),""},error:a})}function Ae(t,e){const r=new Set;for(const c of e)r.add(c.node);const a=new Map,l=r.size;let s=0;const u=[t];P(t,(c,n,o,d)=>(r.has(c)&&(s++,a.set(c,{node:n,parent:o,parentRef:d})),s<l),u,0);for(const c of e){const n=c.action,o=c.node;let d=a.get(o);if(!d)continue;let m=d.parent,p=d.parentRef,f=d.node;const _=c.path;if(_==="children"){if(f.length>1){let h=1;if(typeof f[h]!="string"&&!Array.isArray(f[h])&&h++,n==="delete")f.splice(h,f.length-h);else{const y=c.content,b=C(y);if(b!=="invalid"){const g=b==="fragment";n==="insertBefore"||n==="prepend"?g?f.splice.apply(f,[h,0,...y]):f.splice(h,0,y):n==="insertAfter"||n==="append"?g?f.push.apply(f,y):f.push(y):n==="replace"&&(g?f.splice.apply(f,[h,f.length-h,...y]):f.splice(h,f.length-h,y))}}}continue}else if(_){const h=_.split("/");if(Array.isArray(f)&&f.length>1)f=f[1];else continue;for(const y of h)m=f,p=y,f=m[p]}if(d)if(n==="delete")Array.isArray(m)?typeof p=="number"&&m.splice(p,1):m&&(m[p]=[]);else{const h=c.content,y=C(h);if(y!=="invalid"){const b=y==="fragment";if(n==="insertBefore"||n==="insertAfter"||n==="replace")if(Array.isArray(m)){if(typeof p=="number"){let g=p,S=0;n==="insertAfter"?g++:n==="replace"&&S++,b?m.splice.apply(m,[g,S,...h]):m.splice(g,S,h)}}else m&&(n==="insertBefore"?b?m[p]=[...h,f]:m[p]=[h,f]:n==="insertAfter"?b?m[p]=[f,...h]:m[p]=[f,h]:n==="replace"&&(m[p]=h));else(n==="prepend"||n==="append")&&C(f)==="fragment"&&(n==="append"?b?f.push.apply(f,h):f.push(h):n==="prepend"&&(b?f.splice.apply(f,[0,0,...h]):f.splice(0,0,h)))}}}return u.length===1?u[0]:u}function P(t,e,r,a){if(!t)return!0;const l=C(t);if(Array.isArray(t)&&t.length){if(l==="component"||l==="element"){let s="";const u=t[0].indexOf(be);if(u>-1&&(s=t[0].slice(u+1)),s&&e(s,t,r,a)===!1)return!1;for(let c=1;t.length>c;c++)if(!P(t[c],e,t,c))return!1}else for(let s=0;t.length>s;s++)if(!P(t[s],e,t,s))return!1}else if(typeof t=="object"){for(const s of Object.getOwnPropertyNames(t))if(!P(t[s],e,t,s))return!1}return!0}async function _e(t){if(t.searchInput==="Homer Simpson"){const e=t.src.lastContentKey;if(e==="2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAheEAA"){const r=await L(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAheEAA-4a719544.js"),[]);return await D(300),r.default}if(e==="2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAhAAAB"){const r=await L(()=>import("./homer-more-2ahUKEwjczO7Zgub-AhUZVKQEHZ62Du0Qq7kBKAB6BAhAAAB-cb394a54.js"),[]);return await D(300),r.default}}return{type:"Error",message:"Invalid query: "+t.searchInput}}function D(t){return new Promise(e=>{setTimeout(e,t)})}const X=I("asimo.doc.api.SearchMoreAPI");w.registerService(X,()=>_e);function Ce(){return G.createStore("SearchService",t=>{const e=t.init({query:{searchInput:""},lastResult:null}),r={},a={data:e,async search(s,u=!0){const c=s||e.query,o=await(await w.get(K))(c);return o.type==="SearchResponse"?(await a.loadSearchResponse(o,c,u),!0):!1},async loadSearchResponse(s,u,c=!0){const n={};try{await q(s.bundles,n),c&&await l()}catch(o){console.log("Module load error:",o)}e.lastResult={type:"SearchResults",query:{searchInput:u.searchInput},results:s,lml2jsx:o=>Ne(o,F,(d,m)=>{if(m){if(n&&n[m])return n[m][d]||null}else return r[d]||null;return null})}},async getMoreResults(s,u=!0){if(!e.lastResult||e.lastResult.type!=="SearchResults")return!1;const n=await(await w.get(X))(s);if(n.type==="SearchResponse"){const o={};try{await q(n.bundles,o),u&&await l()}catch(d){console.log("Module load error:",d)}if(n.mainUpdates||n.sidebarUpdates){const d=e.lastResult.results;n.main?d.main=n.main:n.mainUpdates&&Ae(d.main,n.mainUpdates)}}return!0},registerBaseComponent(s,u){r[s]=u}};return a;async function l(){const s=await w.get(k);s.data.mainView={name:"search",panel:"results",$store:a}}})}const Ie=/^(\/)|(.\/)/i;async function q(t,e){if(t){const r=[],a=[];for(const n of Object.getOwnPropertyNames(t)){const o=t[n].ns;t[n].src.match(Ie)&&(r.push({name:n,ns:o,src:t[n].src}),a.push(o))}const l=await w.get.apply(w,a);let s=Array.isArray(l)?l:[l];const u=[],c=[];for(let n=0;s.length>n;n++)s[n]?r[n].module=s[n]:(c.push(n),u.push(L(()=>import(r[n].src),[])));if(c.length){const n=await Promise.all(u);for(let o=0;n.length>o;o++)r[c[o]].module=n[o].default}if(e)for(let n of r)e[n.name]=n.module}}w.registerService(B,Ce);const Re=x("Button",t=>{let{href:e,align:r,className:a,children:l}=t;r=r||"center",a=a||"";let s="justify-center";return r==="start"&&(s="justify-start pl-3"),i("div",{"data-id":A(),className:`btn flex ${a} h-12`,children:i("a",{href:e,className:`flex-grow flex bg-neutral-200 mt-2 rounded-full ${s} hover:bg-neutral-300`,children:i("span",{"data-id":A(),className:"h-full pt-2.5 text-base overflow-hidden",children:l})})})}),Ee=x("Icon",t=>{let{type:e,size:r,className:a}=t;if(e=e||"magnifier",e==="magnifier"){r=r||22;const s=`inline-block relative ${a||"mx-2"}`;return i("svg",{width:r,height:r,viewBox:"0 0 18 18",version:"1.1","aria-hidden":"false",className:s,children:[i("desc",{lang:"en",children:"Magnifying glass"}),i("path",{className:"fill-current  stroke-0",d:"M13.07336,12.29053,10.14679,9.364a3.9711,3.9711,0,1,0-.78284.78284l2.92658,2.92657Zm-6.064-2.4516A2.82914,2.82914,0,1,1,9.8385,7.00934,2.83286,2.83286,0,0,1,7.00934,9.83893Z"})]})}r=r||18;const l=`inline-block relative ${a||"-top-0.5 mx-2"}`;return i("svg",{width:r,height:r,focusable:"false",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 22",className:l,children:i("path",{d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})})}),Pe=x("Columns",t=>{let{className:e,children:r}=t;return e=e||"mt-4",i("div",{"data-id":A(),className:`columns ${e} columns-2`,children:i("div",{children:r})})});async function Le(){const t=await w.get(k),e=globalThis["init-state"],r=await w.get(B);r.registerBaseComponent("btn",Re),r.registerBaseComponent("icon",Ee),r.registerBaseComponent("cols",Pe),e&&e.dataType==="SearchResponse"&&await r.loadSearchResponse(e.data.response,e.data.query);const a=le();W(i(a,{children:i("div",{className:"mainapp",children:i(he,{nav:t})})}),document.getElementById("main"))}Le();
